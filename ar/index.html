<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>加速度の値を得る</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
</head>
 
<body>
<div id="txt">ここにデータを表示</div> 
<div id ="test">こんにちは</div>
 
<script>
function ClickRequestDeviceSensor(){
  //. ユーザーに「許可」を求めるダイアログを表示
  DeviceOrientationEvent.requestPermission().then( function( response ){
    if( response === 'granted' ){
      //. 許可された場合のみイベントハンドラを追加できる
      window.addEventListener( "deviceorientation", deviceOrientation );
      window.addEventListener( "devicemotion", deviceMotion );
      //. 画面上部のボタンを消す
      $('#sensorrequest').css( 'display', 'none' );
    }
  }).catch( function( e ){
    console.log( e );
  });

  DeviceMotionEvent.requestPermission().then( function( response ){
    alert("OK");
    if( response === 'granted' ){
      //. 許可された場合のみイベントハンドラを追加できる
      window.addEventListener( "devicemotion", deviceMotion );
      //. 画面上部のボタンを消す
      $('#sensorrequest').css( 'display', 'none' );
    }
  }).catch( function( e ){
    console.log( e );
  });

}

if( window.DeviceOrientationEvent ){
  if( DeviceOrientationEvent.requestPermission && typeof DeviceOrientationEvent.requestPermission === 'function' ){
    //. iOS 13 以上の場合、
    //. 画面上部に「センサーの有効化」ボタンを追加
    var banner = '<button  style="z-index: 1; position: absolute; width: 100%; background-color: rgb(0, 0, 0);" onclick="ClickRequestDeviceSensor();" id="sensorrequest"><p style="color: rgb(255, 255, 255);">センサーの有効化</p></button>';
    $("body").prepend( banner );
  }else{
  }
}
function deviceOrientation( e ){
  //. 通常の処理を無効にする
  e.preventDefault();
  //. スマホの向きを取得
  var dir = e.alpha;   //. 北極方向に対する向きの角度
  var fb = e.beta;      //. 前後の傾き角度
  var lr = e.gamma;  //. 左右の傾き角度
  var txt = document.getElementById("txt");   // データを表示するdiv要素の取得
    txt.innerHTML = "角度: " + dir + "<br>"         // x軸の値
                  + "左右: " + fb + "<br>"         // y軸の値
                  + "前後: " + lr;        
}

function deviceMotion (e) {
  e.preventDefault();

  var aX = e.accelerationIncludingGravity.x;  
  var aY = e.accelerationIncludingGravity.y;  
  var aZ = e.accelerationIncludingGravity.z + 9.8 ;  

 var txt = document.getElementById("test");   // データを表示するdiv要素の取得
    txt.innerHTML = "x: " + aX + "<br>"         // x軸の値
                  + "y: " + aY + "<br>"         // y軸の値
                  + "z: " + aZ ;   
}

function drawBall() {
    var centerX = canvas.width  / 2;            // canvasの中心のX座標
    var centerY = canvas.height / 2;	        // canvasの中心のY座標
    var ballRad = 50;                           // ボールの半径
    var ballColor = "rgb(0, 0, 255)";           // ボールの色
    var g  = 9.80665;                           // 1Gの時の重力加速度[m/s^2]
    var d  = centerX / g;                       // 1m/s^2 あたりでボールが動く量
    var os = navigator.platform;                // OS名の取得
    if(os === "iPhone" || os === "iPad" || os === "iPod") {     // iOSなら
        aX *= -1;                               // 加速度の正負を反転させる
        aY *= -1;                               // a *= b は a = a * b の意味
        aZ *= -1;
    }
    context.clearRect(0, 0, canvas.width, canvas.height);   // canvasの内容を消す clearRect(x, y, w, h)
    context.beginPath();                        // 描画開始
    context.arc(centerX - d * aX,               // 円を描く arc(x, y, 半径, 開始角度, 終了角度)
                centerY + d * aY,               // 加速度xとyに、1m/s^2あたりで動く量dをかける
                ballRad - 3 * aZ,               // ボールの半径（zに掛けた係数3はテキトー）
                0, 2 * Math.PI);                // 角度の単位はラジアン（2π = 360度）で指定
    context.fillStyle = ballColor;              // 塗りつぶす色の設定
    context.fill();                             // 塗る
}



</script>

</body>
</html>